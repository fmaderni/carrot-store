---
/* Componente solo visual + JS de apertura/cierre */
---
<!-- Overlay -->
<div id="cart-overlay"
     class="fixed inset-0 bg-black/50 opacity-0 pointer-events-none transition-opacity z-40"></div>

<!-- Drawer -->
<aside id="cart-drawer"
       class="fixed inset-y-0 right-0 w-full max-w-md bg-white shadow-xl translate-x-full transition-transform duration-300 z-50">
  <header class="flex items-center justify-between p-4 border-b">
    <h2 class="text-lg font-semibold">Tu carrito</h2>
    <button id="close-cart" type="button" class="text-2xl leading-none">×</button>
  </header>

  <div class="p-4 space-y-3">
    <!-- Contenido mínimo de ejemplo. Podés reemplazar por tu lista real -->
    <p class="text-sm text-stone-600">Acá van los productos del carrito.</p>
    <a href="/carrito" class="inline-flex items-center justify-center rounded-lg border px-4 py-2">
      Ver carrito
    </a>
  </div>
</aside>

<script>
  (function () {
    const drawer  = document.getElementById('cart-drawer');
    const overlay = document.getElementById('cart-overlay');
    const openBtn = document.getElementById('cart-badge');
    const closeBtn = document.getElementById('close-cart');

    function openDrawer() {
      drawer.classList.remove('translate-x-full');
      overlay.classList.remove('opacity-0', 'pointer-events-none');
      document.body.style.overflow = 'hidden';
    }
    function closeDrawer() {
      drawer.classList.add('translate-x-full');
      overlay.classList.add('opacity-0', 'pointer-events-none');
      document.body.style.overflow = '';
    }
    function safe(fn){ return (e)=>{ e && e.preventDefault && e.preventDefault(); fn(); } }

    openBtn && openBtn.addEventListener('click', safe(openDrawer));
    closeBtn && closeBtn.addEventListener('click', safe(closeDrawer));
    overlay.addEventListener('click', closeDrawer);
    window.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeDrawer(); });

    // --- contador del badge ---
    function updateCount() {
      const el = document.getElementById('cart-count');
      if (!el) return;
      try {
        const cart = JSON.parse(localStorage.getItem('cart') || '[]');
        const total = cart.reduce((sum, item) => sum + (item.qty || 1), 0);
        el.textContent = String(total);
      } catch (_) { /* noop */ }
    }
    updateCount();
    // Si tu lógica de "agregar al carrito" hace localStorage.setItem, podés llamar esto:
    document.addEventListener('cart:updated', updateCount);
    window.addEventListener('storage', updateCount); // entre pestañas
  })();
</script>
