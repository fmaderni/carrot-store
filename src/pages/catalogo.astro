---
import BaseLayout from "../layouts/BaseLayout.astro";
import ProductCard from "../components/ProductCard.astro";
import products from "../data/products.json";

const url = new URL(Astro.request.url);
const cat = url.searchParams.get("categoria"); // Pantalón | Remera | Campera
const talle = url.searchParams.get("talle");   // S | M | L
const q = url.searchParams.get("q")?.toLowerCase().trim() || "";

const listado = products
  .filter(p => !cat || p.category === cat)
  .filter(p => !talle || p.sizes.includes(talle))
  .filter(p => !q || (
    p.title.toLowerCase().includes(q) ||
    p.category.toLowerCase().includes(q) ||
    p.color?.toLowerCase().includes(q)
  ));
const categorias = ["Pantalón", "Remera", "Campera"];
const talles = ["S", "M", "L"];
---
<BaseLayout title="Catálogo">

  <section class="mx-auto max-w-6xl px-4 py-10">
    <h1 class="text-3xl font-bold tracking-tight">Catálogo</h1>

    <form class="mt-6 grid gap-3 sm:grid-cols-4" method="get">
      <select name="categoria" class="rounded-lg border px-3 py-2">
        <option value="">Todas las categorías</option>
        {categorias.map(c => <option selected={c===cat} value={c}>{c}</option>)}
      </select>

      <select name="talle" class="rounded-lg border px-3 py-2">
        <option value="">Todos los talles</option>
        {talles.map(t => <option selected={t===talle} value={t}>{t}</option>)}
      </select>

      <input name="q" placeholder="Buscar (ej: negro, denim)"
        value={q} class="rounded-lg border px-3 py-2" />

      <div class="flex gap-2">
        <button class="rounded-lg bg-orange-600 text-white px-4 py-2">Filtrar</button>
        <a href="/catalogo" class="rounded-lg border px-4 py-2">Limpiar</a>
      </div>
    </form>

    {listado.length === 0
      ? <p class="mt-10 text-stone-600">No hay resultados con esos filtros.</p>
      : <div class="mt-8 grid gap-6 sm:grid-cols-2 md:grid-cols-3">
          {listado.map(p => <ProductCard product={p} />)}
        </div>
    }
  </section>

</BaseLayout>
